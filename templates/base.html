{% load static tailwind_tags %} 
<!DOCTYPE html> 
<html lang="es"> 
<head> 
<meta charset="UTF-8"> 
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

<title>{% block title %}Consultorio Médico{% endblock %}</title>
{% tailwind_css %} 
<style>
    :root {
        --primary: #43d18d; /* Verde claro */
        --primary-light: #e0f7fa; /* Celeste muy claro */
        --primary-dark: #00bcd4; /* Celeste */
        --secondary: #00bcd4; /* Celeste */
        --secondary-dark: #43d18d; /* Verde claro */
        --text-dark: #1a1a1a; /* Negro suave */
        --text-light: #64748B; /* Gris azulado suave */
        --background: #fff; /* Blanco */
        --surface: #f4f8fb; /* Blanco azulado */
        --danger: #DC2626;
    }
    body {
        font-family: 'Inter', sans-serif;
        color: var(--text-dark);
        background-color: var(--background);
        transition: background 0.3s, color 0.3s;
    }
    h1, h2, h3, h4, h5, h6 {
        font-family: 'Poppins', sans-serif;
    }
    .medical-gradient {
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    }
    /* --- Modo oscuro global --- */
    .dark-mode {
        background: #111 !important;
        color: #e0f7fa !important;
    }
    .dark-mode header, .dark-mode .header {
        background: #181f23 !important;
        color: #e0f7fa;
    }
    .dark-mode h1, .dark-mode h2, .dark-mode h3, .dark-mode h4, .dark-mode h5, .dark-mode h6 {
        color: #e0f7fa !important;
    }
    .dark-mode p, .dark-mode span, .dark-mode label, .dark-mode li, .dark-mode a, .dark-mode .text-gray-700, .dark-mode .text-gray-800, .dark-mode .text-gray-600, .dark-mode .text-gray-500 {
        color: #b2dfdb !important;
    }
    .dark-mode .bg-white, .dark-mode .rounded-xl.shadow-sm, .dark-mode .rounded-xl.shadow-lg, .dark-mode .rounded-xl.shadow-xl, .dark-mode .bg-gray-50 {
        background: #181f23 !important;
        color: #e0f7fa !important;
        box-shadow: 0 4px 32px rgba(67,209,141,0.08) !important;
    }
    .dark-mode .medical-gradient {
        background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%) !important;
    }
    .dark-mode .border-gray-100, .dark-mode .border-gray-200, .dark-mode .border-t {
        border-color: var(--primary-dark) !important;
    }
    .dark-mode select, .dark-mode input, .dark-mode textarea {
        background: #181f23 !important;
        color: #e0f7fa !important;
        border-color: var(--primary-dark) !important;
    }
    .dark-mode .chatbot-window {
        background: #181f23 !important;
        color: #e0f7fa !important;
        border-color: var(--primary-dark) !important;
    }
    .dark-mode .chatbot-header {
        background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%) !important;
        color: #fff !important;
    }
    .dark-mode .chatbot-messages {
        background: #111 !important;
        color: #e0f7fa !important;
    }
    .dark-toggle-btn {
        background: transparent;
        border: none;
        font-size: 1.3rem;
        cursor: pointer;
        transition: color 0.3s;
    }
    .dark-mode .dark-toggle-btn {
        color: var(--primary-dark);
    }
    .dark-toggle-btn:hover {
        color: var(--primary);
    }
    /* Tarjetas de módulos */
    .module-card {
        background: var(--surface);
        border-radius: 1.2rem;
        box-shadow: 0 4px 24px rgba(67, 209, 141, 0.08);
        padding: 2rem 1.5rem 1.5rem 1.5rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: transform 0.2s, box-shadow 0.2s;
        cursor: pointer;
        border: 2px solid transparent;
        margin-bottom: 1.5rem;
    }
    .module-card:hover {
        transform: translateY(-6px) scale(1.03);
        box-shadow: 0 8px 32px rgba(67, 209, 141, 0.18);
        border-color: var(--primary);
    }
    .module-icon {
        font-size: 2.5rem;
        color: var(--primary);
        background: var(--primary-light);
        border-radius: 1rem;
        padding: 0.7rem 1rem;
        margin-bottom: 1rem;
        box-shadow: 0 2px 8px rgba(67, 209, 141, 0.08);
        transition: background 0.2s, color 0.2s;
    }
    .dark-mode .module-card {
        background: #181f23 !important;
        color: #e0f7fa !important;
        box-shadow: 0 4px 32px rgba(0,188,212,0.08) !important;
        border-color: var(--primary-dark) !important;
    }
    .dark-mode .module-card:hover {
        border-color: var(--primary) !important;
        box-shadow: 0 8px 32px rgba(0,188,212,0.18) !important;
    }
    .dark-mode .module-icon {
        color: var(--primary-dark) !important;
        background: var(--primary) !important;
    }
    /* Footer y textos secundarios */
    .text-secondary {
        color: var(--text-light);
    }
    .dark-mode .text-secondary {
        color: #b2dfdb !important;
    }
    .text-primary {
        color: var(--primary);
    }
    .dark-mode .text-primary {
        color: var(--primary-dark) !important;
    }
    .bg-primary {
        background: var(--primary);
    }
    .dark-mode .bg-primary {
        background: var(--primary-dark) !important;
    }
    .bg-secondary {
        background: var(--secondary);
    }
    .dark-mode .bg-secondary {
        background: var(--primary) !important;
    }
</style>
</head> 
<body class="bg-gray-50 min-h-screen"> 
<div class="container mx-auto px-4 py-6"> 

{% block navBar %}
<header class="bg-white shadow-md rounded-xl sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-6 py-3">
        <div class="flex items-center justify-between">
            <!-- Logo and Title -->
            <div class="flex items-center space-x-4">
                <a href="{% url 'home' %}" class="w-12 h-12 rounded-xl flex items-center justify-center shadow-lg transition-transform duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-primary">
                    <img src="{% static 'img/logo.png' %}" alt="Logo SaludTotal" class="w-104 h-34 object-contain rounded-xl bg-transparent" />
                </a>
                <div>
                    <h1 class="text-2xl font-extrabold text-primary drop-shadow-sm tracking-tight">Clinic Pro</h1>
                    <p class="text-sm text-secondary font-medium">La mejor clinica</p>
                </div>
            </div>
            <!-- User Profile / Login y Botón modo oscuro a la derecha -->
            <div class="flex items-center space-x-4">
                {% if user.is_authenticated %}
                    <!-- Groups Selector -->
                    <div class="relative">
                        <select id="groupSelect" class="bg-white border border-gray-200 rounded-lg px-4 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-all duration-300 shadow-md hover:shadow-lg">
                            <option value="">Seleccionar Grupo</option>
                            {% for group in group_list %}
                                <option value="{{ group.id }}" {% if request.GET.gpid == group.id|stringformat:"s" %}selected{% endif %}>
                                    {{ group.name }}
                                </option>
                            {% empty %}
                                <option value="" disabled>Sin grupos asignados</option>
                            {% endfor %}
                        </select>
                    </div>
                {% endif %}
                <!-- Botón modo oscuro a la derecha -->
                <button id="darkToggleBtn" class="dark-toggle-btn ml-2" title="Modo oscuro 🌙">🌙</button>
                {% if user.is_authenticated %}
            <!-- User Dropdown -->
                <div class="relative">
                    <button id="userDropdown" class="flex items-center space-x-3 bg-white rounded-full shadow-md px-4 py-2 hover:shadow-lg transition-all duration-300 border border-gray-100">
                        <div class="w-8 h-8 rounded-full medical-gradient flex items-center justify-center">
                            <i class="fas fa-user text-white"></i>
                        </div>
                        <div class="text-left">
                            <span class="text-gray-700 font-medium block">{{ user.username }}</span>
                            {% if group_list.exists %}
                                <span class="text-xs text-gray-500">{{ group.name }}</span>
                            {% endif %}
                        </div>
                        <i class="fas fa-chevron-down text-gray-500 transition-transform duration-200" id="userDropdownIcon"></i>
                    </button>
                    <!-- Dropdown Menu -->
                    <div id="userDropdownMenu" class="absolute right-0 mt-2 w-64 bg-white rounded-xl shadow-xl border border-gray-100 opacity-0 invisible transform scale-95 transition-all duration-200 z-50">
                        <div class="py-2">
                            <!-- User Info -->
                            <div class="px-4 py-3 border-b border-gray-100">
                                <p class="text-sm font-medium text-gray-900"><i class="fas fa-user-circle mr-2 text-primary"></i>{{ user.username }}</p>
                                <p class="text-sm text-gray-500"><i class="fas fa-envelope mr-2"></i>{{ user.email|default:"Sin email" }}</p>
                                {% if user.group.exists %}
                                    <div class="mt-2">
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                            <i class="fas fa-users mr-1"></i>{{ user.group.name }}
                                        </span>
                                    </div>
                                {% endif %}
                            </div>
                            <!-- Menu Items -->
                            <a href="#" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors duration-200">
                                <i class="fas fa-user-cog w-4 h-4 mr-3 text-primary"></i>
                                Perfil
                            </a>
                            <a href="#" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors duration-200">
                                <i class="fas fa-cog w-4 h-4 mr-3 text-primary"></i>
                                Cuenta
                            </a>
                            <div class="border-t border-gray-100 my-1"></div>
                            <form method="POST" action="{% url 'security:signout' %}" class="block">
                                {% csrf_token %}
                                <button type="submit" class="flex items-center w-full px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors duration-200">
                                    <i class="fas fa-sign-out-alt w-4 h-4 mr-3 text-red-500"></i>
                                    Cerrar Sesión
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                {% else %}
                    <!-- Login Button -->
                    <a href="{% url 'security:signin' %}" class="flex items-center space-x-2 medical-gradient text-white font-medium px-6 py-2 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
                        </svg>
                        <span>Iniciar Sesión</span>
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
</header>
{% endblock navBar %}

    {% block dashboard_header %}
    <!-- Breadcrumb & Page Info -->
    <!-- <div class="mt-6 mb-8 flex flex-col sm:flex-row sm:items-center sm:justify-between">
         <div class="mb-4 sm:mb-0">
            <h2 class="text-2xl font-extrabold text-primary drop-shadow-sm">{% block page_title %}Panel de Control{% endblock %}</h2>
            <nav class="flex items-center mt-2" aria-label="Breadcrumb">
                <ol class="flex items-center space-x-2 text-sm">
                    <li>
                        <a href="#" class="inline-flex items-center px-3 py-1 rounded-lg bg-primary-light text-primary font-medium hover:bg-primary hover:text-white transition">
                            <i class="fas fa-home mr-1"></i>Inicio
                        </a>
                    </li>
                    <li>
                        <svg class="w-4 h-4 mx-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </li>
                    <li>
                        <span class="inline-flex items-center px-3 py-1 rounded-lg bg-secondary text-white font-semibold shadow">{% block breadcrumb %}Dashboard{% endblock %}</span>
                    </li>
                </ol>
            </nav>
        </div>
        <div>
            {% block page_actions %}{% endblock %}
        </div>
    </div>
    {% endblock dashboard_header %} -->

<div class="bg-white rounded-xl shadow-sm p-6 mb-8">
    {% block content %}{% endblock content %}
    {% block modules %}
    <!-- Módulos visuales
    <div class="flex items-center mb-6">
        <span class="inline-flex items-center justify-center w-12 h-12 rounded-xl medical-gradient shadow-lg mr-4">
            <i class="fas fa-th-large text-white text-2xl"></i>
        </span>
        <h1 class="text-3xl font-extrabold text-primary tracking-tight drop-shadow-sm">Módulos Visuales</h1>
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 mt-6">
        <div class="module-card">
            <span class="module-icon"><i class="fas fa-user-injured"></i></span>
            <span class="font-bold text-lg">Pacientes</span>
        </div>
        <div class="module-card">
            <span class="module-icon"><i class="fas fa-user-md"></i></span>
            <span class="font-bold text-lg">Doctores</span>
        </div>
        <div class="module-card">
            <span class="module-icon"><i class="fas fa-calendar-check"></i></span>
            <span class="font-bold text-lg">Citas</span>
        </div>
        <div class="module-card">
            <span class="module-icon"><i class="fas fa-user-shield"></i></span>
            <span class="font-bold text-lg">Seguridad</span>
        </div>
        <div class="module-card">
            <span class="module-icon"><i class="fas fa-file-medical"></i></span>
            <span class="font-bold text-lg">Expedientes</span>
        </div>
        <div class="module-card">
            <span class="module-icon"><i class="fas fa-pills"></i></span>
            <span class="font-bold text-lg">Recetas</span>
        </div>
        <div class="module-card">
            <span class="module-icon"><i class="fas fa-chart-bar"></i></span>
            <span class="font-bold text-lg">Reportes</span>
        </div>
        <div class="module-card">
            <span class="module-icon"><i class="fas fa-cogs"></i></span>
            <span class="font-bold text-lg">Configuración</span>
        </div>
        <div class="module-card">
            <span class="module-icon"><i class="fas fa-briefcase-medical"></i></span>
            <span class="font-bold text-lg">Inventario</span>
        </div>
        <div class="module-card">
            <span class="module-icon"><i class="fas fa-hospital-user"></i></span>
            <span class="font-bold text-lg">Admisión</span>
        </div>
        <div class="module-card">
            <span class="module-icon"><i class="fas fa-ambulance"></i></span>
            <span class="font-bold text-lg">Emergencias</span>
        </div>
        <div class="module-card">
            <span class="module-icon"><i class="fas fa-stethoscope"></i></span>
            <span class="font-bold text-lg">Consultas</span>
        </div>
    </div>
    {% endblock modules %}
</div> -->
<!-- Footer Moderno y Minimalista Mejorado -->
<footer class="mt-16 bg-white/95 dark:bg-[#181f23]/95 backdrop-blur-lg rounded-2xl shadow-2xl px-8 py-10 border-t border-gray-100 relative overflow-hidden">
    <!-- Fondo decorativo SVG -->
    <div class="absolute inset-0 pointer-events-none -z-10">
        <svg width="100%" height="100%" viewBox="0 0 600 200" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full h-full">
            <ellipse cx="500" cy="180" rx="180" ry="60" fill="#43d18d" fill-opacity="0.10"/>
            <ellipse cx="100" cy="40" rx="120" ry="40" fill="#00bcd4" fill-opacity="0.10"/>
        </svg>
    </div>
    <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-8">
        <!-- Logo y descripción -->
        <div class="flex flex-col items-center md:items-start text-center md:text-left mb-6 md:mb-0">
            <div class="flex items-center space-x-3 mb-2">
                <img src="{% static 'img/logo.png' %}" alt="Logo SaludTotal" class="w-14 h-14 rounded-2xl bg-primary-light shadow-lg border-2 border-primary" />
                <span class="text-2xl font-extrabold text-primary tracking-tight">Clinic Pro</span>
            </div>
            <p class="text-sm text-gray-600 dark:text-gray-400">&copy; {% now "Y" %} SaludTotal. Todos los derechos reservados.</p>
            <p class="text-xs text-gray-400 mt-1">Desarrollado por el equipo de Clinic Pro.<br>
                <a href="mailto:soporte@saludtotal.com" class="text-primary hover:underline">soporte@saludtotal.com</a>
            </p>
        </div>
        <!-- Navegación y redes mejor alineadas en columna en móvil y fila en desktop -->
        <div class="flex flex-col md:flex-row items-center md:items-end gap-6 w-full justify-between">
            <!-- Navegación -->
            <nav class="flex flex-wrap gap-4 mb-2 md:mb-0 justify-center">
                <a href="#" class="text-gray-500 hover:text-primary text-sm transition-colors duration-200 flex items-center gap-1 font-medium">
                    <i class="fas fa-info-circle"></i>Acerca de
                </a>
                <a href="#" class="text-gray-500 hover:text-primary text-sm transition-colors duration-200 flex items-center gap-1 font-medium">
                    <i class="fas fa-user-secret"></i>Privacidad
                </a>
                <a href="#" class="text-gray-500 hover:text-primary text-sm transition-colors duration-200 flex items-center gap-1 font-medium">
                    <i class="fas fa-file-contract"></i>Términos
                </a>
                <a href="#" class="text-gray-500 hover:text-primary text-sm transition-colors duration-200 flex items-center gap-1 font-medium">
                    <i class="fas fa-headset"></i>Soporte
                </a>
            </nav>
            <!-- Redes sociales -->
            <div class="flex gap-4 justify-center">
                <a href="#" class="text-primary bg-primary-light hover:bg-primary hover:text-white transition-colors duration-300 rounded-full p-3 shadow-lg" title="Facebook">
                    <i class="fab fa-facebook-f fa-lg"></i>
                </a>
                <a href="#" class="text-primary bg-primary-light hover:bg-primary hover:text-white transition-colors duration-300 rounded-full p-3 shadow-lg" title="Twitter">
                    <i class="fab fa-twitter fa-lg"></i>
                </a>
                <a href="#" class="text-primary bg-primary-light hover:bg-primary hover:text-white transition-colors duration-300 rounded-full p-3 shadow-lg" title="Instagram">
                    <i class="fab fa-instagram fa-lg"></i>
                </a>
            </div>
        </div>
    </div>
    <div class="mt-8 border-t border-gray-100 pt-6 flex flex-col md:flex-row justify-between items-center gap-4 text-xs text-gray-400 dark:text-gray-500">
        <div class="flex items-center gap-2">
            <i class="fas fa-map-marker-alt text-primary"></i>
            <span>Av. Siempre Viva 123, Ciudad Salud, País</span>
        </div>
        <div class="flex items-center gap-2">
            <i class="fas fa-phone-alt text-primary"></i>
            <span>+52 123 456 7890</span>
            <span class="mx-2">|</span>
            <i class="fas fa-envelope text-primary"></i>
            <span>contacto@saludtotal.com</span>
        </div>
    </div>
    <div class="mt-6 flex justify-center">
        <span class="inline-flex items-center px-4 py-1 rounded-full bg-primary-light text-primary font-semibold text-xs shadow gap-2">
            <i class="fas fa-heartbeat text-primary"></i>
            ¡Gracias por confiar en nosotros!
        </span>
    </div>
</footer>

<!-- Chatbot Flotante -->
<style>
    .chatbot-btn {
        position: fixed;
        bottom: 32px;
        right: 32px;
        z-index: 100;
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        color: #fff;
        border-radius: 50%;
        width: 64px;
        height: 64px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 24px rgba(25, 118, 210, 0.2);
        cursor: pointer;
        transition: box-shadow 0.2s, transform 0.2s;
    }
    .chatbot-btn:hover {
        box-shadow: 0 8px 32px rgba(25, 118, 210, 0.3);
        transform: scale(1.08);
    }
    .chatbot-window {
        position: fixed;
        bottom: 110px;
        right: 32px;
        width: 340px;
        max-width: 95vw;
        background: #fff;
        border-radius: 1.5rem;
        box-shadow: 0 8px 32px rgba(25, 118, 210, 0.18);
        z-index: 101;
        display: none;
        flex-direction: column;
        overflow: hidden;
        border: 1px solid #e3e3e3;
        animation: slideInUp 0.4s cubic-bezier(0.4,0,0.2,1);
    }
    @keyframes slideInUp {
        from { transform: translateY(40px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
    .chatbot-header {
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        color: #fff;
        padding: 1rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    .chatbot-messages {
        padding: 1rem;
        height: 220px;
        overflow-y: auto;
        background: #f8fafc;
        font-size: 0.95rem;
    }
    .chatbot-input {
        display: flex;
        border-top: 1px solid #e3e3e3;
        background: #fff;
    }
    .chatbot-input input {
        flex: 1;
        border: none;
        padding: 0.75rem 1rem;
        font-size: 1rem;
        outline: none;
        background: transparent;
    }
    .chatbot-input button {
        background: var(--primary);
        color: #fff;
        border: none;
        padding: 0 1.2rem;
        font-size: 1.2rem;
        cursor: pointer;
        border-radius: 0 0 1.5rem 0;
        transition: background 0.2s;
    }
    .chatbot-input button:hover {
        background: var(--secondary);
    }
</style>
<div class="chatbot-btn" id="chatbotBtn" title="¿Necesitas ayuda?">
    <i class="fas fa-robot fa-2x"></i>
</div>
<div class="chatbot-window" id="chatbotWindow">
    <div class="chatbot-header">
        <span>Asistente Virtual</span>
        <button id="closeChatbot" style="background:transparent;color:#fff;font-size:1.2rem;border:none;cursor:pointer;">&times;</button>
    </div>
    <div class="chatbot-messages" id="chatbotMessages">
        <div><strong>Bot:</strong> ¡Hola! ¿En qué puedo ayudarte hoy?</div>
    </div>
    <form class="chatbot-input" id="chatbotForm" autocomplete="off">
        <input type="text" id="chatbotInput" placeholder="Escribe tu mensaje..." required />
        <button type="submit"><i class="fas fa-paper-plane"></i></button>
    </form>
</div>

{% block js %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    // --- Modo Oscuro ---
    const toggleBtn = document.getElementById('darkToggleBtn');
    const rootElement = document.body;
    // Activar modo oscuro si está guardado en localStorage
    if (localStorage.getItem('dark-mode') === 'true') {
        rootElement.classList.add('dark-mode');
        toggleBtn.textContent = '☀️';
    } else {
        toggleBtn.textContent = '🌙';
    }
    toggleBtn.addEventListener('click', function () {
        rootElement.classList.toggle('dark-mode');
        const isDark = rootElement.classList.contains('dark-mode');
        localStorage.setItem('dark-mode', isDark);
        toggleBtn.textContent = isDark ? '☀️' : '🌙';
    });

    // --- User Dropdown ---
    const userDropdown = document.getElementById('userDropdown');
    const userDropdownMenu = document.getElementById('userDropdownMenu');
    const userDropdownIcon = document.getElementById('userDropdownIcon');
    if (userDropdown && userDropdownMenu) {
        userDropdownMenu.classList.add('opacity-0', 'invisible', 'scale-95');
        userDropdownMenu.classList.remove('opacity-100', 'visible', 'scale-100');
        userDropdown.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            const isVisible = !userDropdownMenu.classList.contains('invisible');
            if (isVisible) {
                userDropdownMenu.classList.add('opacity-0', 'invisible', 'scale-95');
                userDropdownMenu.classList.remove('opacity-100', 'visible', 'scale-100');
                userDropdownIcon.classList.remove('rotate-180');
            } else {
                userDropdownMenu.classList.remove('opacity-0', 'invisible', 'scale-95');
                userDropdownMenu.classList.add('opacity-100', 'visible', 'scale-100');
                userDropdownIcon.classList.add('rotate-180');
            }
        });
        document.addEventListener('click', function(e) {
            if (!userDropdown.contains(e.target) && !userDropdownMenu.contains(e.target)) {
                userDropdownMenu.classList.add('opacity-0', 'invisible', 'scale-95');
                userDropdownMenu.classList.remove('opacity-100', 'visible', 'scale-100');
                userDropdownIcon.classList.remove('rotate-180');
            }
        });
        userDropdownMenu.addEventListener('click', function(e) {
            e.stopPropagation();
        });
    }

    // --- Selector de grupo ---
    const groupSelect = document.getElementById('groupSelect');
    if (groupSelect) {
        groupSelect.addEventListener('change', function() {
            const selectedGroupId = this.value;
            if (selectedGroupId) {
                window.location.href = `{% url 'home' %}?gpid=${selectedGroupId}`;
            } else {
                window.location.href = `{% url 'home' %}`;
            }
        });
    }

    // --- Animaciones de tarjetas ---
    const statsCards = document.querySelectorAll('.grid > div');
    statsCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        setTimeout(() => {
            card.style.transition = 'all 0.6s ease-out';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });

    // --- Ripple en botones ---
    const buttons = document.querySelectorAll('button');
    buttons.forEach(button => {
        button.addEventListener('click', function(e) {
            if (this.disabled) return;
            const ripple = document.createElement('span');
            const rect = this.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;
            ripple.style.width = ripple.style.height = size + 'px';
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';
            ripple.classList.add('ripple');
            this.appendChild(ripple);
            setTimeout(() => {
                ripple.remove();
            }, 600);
        });
    });

    // --- Scroll suave a módulos ---
    statsCards.forEach(card => {
        card.addEventListener('click', function() {
            const modulesGrid = document.querySelector('.grid.grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-3');
            if (modulesGrid) {
                modulesGrid.scrollIntoView({ behavior: 'smooth' });
            }
        });
    });

    // --- Intersection observer para animaciones ---
    const observerOptions = { threshold: 0.1, rootMargin: '0px 0px -50px 0px' };
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(function(entry) {
            if (entry.isIntersecting) {
                entry.target.style.animation = 'slideInRight 0.6s ease-out forwards';
            }
        });
    }, observerOptions);
    document.querySelectorAll('.module-card').forEach(function(card) {
        observer.observe(card);
    });

    // --- Chatbot flotante ---
    const chatbotBtn = document.getElementById('chatbotBtn');
    const chatbotWindow = document.getElementById('chatbotWindow');
    const closeChatbot = document.getElementById('closeChatbot');
    const chatbotForm = document.getElementById('chatbotForm');
    const chatbotInput = document.getElementById('chatbotInput');
    const chatbotMessages = document.getElementById('chatbotMessages');
    if (chatbotBtn && chatbotWindow && closeChatbot && chatbotForm && chatbotInput && chatbotMessages) {
        chatbotBtn.addEventListener('click', function() {
            chatbotWindow.style.display = chatbotWindow.style.display === 'flex' ? 'none' : 'flex';
            chatbotWindow.style.flexDirection = 'column';
        });
        closeChatbot.addEventListener('click', function() {
            chatbotWindow.style.display = 'none';
        });
        chatbotForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const userMsg = chatbotInput.value.trim();
            if (!userMsg) return;
            const userDiv = document.createElement('div');
            userDiv.innerHTML = `<strong>Tú:</strong> ${userMsg}`;
            chatbotMessages.appendChild(userDiv);
            chatbotInput.value = '';
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
            setTimeout(() => {
                const botDiv = document.createElement('div');
                botDiv.innerHTML = `<strong>Bot:</strong> ${getBotReply(userMsg)}`;
                chatbotMessages.appendChild(botDiv);
                chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
            }, 700);
        });
        function getBotReply(msg) {
            msg = msg.toLowerCase();
            if (msg.includes('cita')) return 'Para agendar una cita, dirígete al módulo de citas en el menú principal.';
            if (msg.includes('doctor')) return 'Puedes ver la lista de doctores en la sección "Doctores".';
            if (msg.includes('horario')) return 'El horario de atención es de lunes a viernes de 8:00 a 18:00.';
            if (msg.includes('ayuda')) return 'Estoy aquí para ayudarte. ¿Sobre qué tema necesitas información?';
            return '¡Gracias por tu mensaje! Un asesor te responderá pronto.';
        }
    }
});
</script>
{% endblock %}
</div> 

<!-- Fondo decorativo moderno y dinámico -->
<div class="fixed inset-0 -z-10 pointer-events-none">
    <svg width="100vw" height="100vh" viewBox="0 0 1920 1080" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full h-full absolute">
        <defs>
            <radialGradient id="bg1" cx="50%" cy="40%" r="80%" fx="60%" fy="30%" gradientTransform="rotate(10)">
                <stop offset="0%" stop-color="#e0f7fa" stop-opacity="0.7"/>
                <stop offset="60%" stop-color="#43d18d" stop-opacity="0.18"/>
                <stop offset="100%" stop-color="#00bcd4" stop-opacity="0.10"/>
            </radialGradient>
            <linearGradient id="bg2" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0%" stop-color="#43d18d" stop-opacity="0.18"/>
                <stop offset="100%" stop-color="#00bcd4" stop-opacity="0.12"/>
            </linearGradient>
        </defs>
        <ellipse cx="600" cy="300" rx="520" ry="320" fill="url(#bg1)"/>
        <ellipse cx="1600" cy="900" rx="400" ry="220" fill="url(#bg2)"/>
        <ellipse cx="200" cy="900" rx="220" ry="120" fill="#43d18d" fill-opacity="0.10"/>
        <ellipse cx="1700" cy="200" rx="180" ry="90" fill="#00bcd4" fill-opacity="0.10"/>
        <ellipse cx="960" cy="1000" rx="700" ry="100" fill="#e0f7fa" fill-opacity="0.12"/>
    </svg>
</div>
</body> 
</html>